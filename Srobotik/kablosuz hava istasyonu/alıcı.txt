// ðŸ”¸ ALICI ARDUINO - SICAKLIK GÃ–STERÄ°CÄ° LCD ðŸ”¸

#include <LiquidCrystal.h>

LiquidCrystal lcd(12, 11, 5, 4, 3, 2); // Portlar aynÄ±

float temperature = 0.0;
float lastDisplayedTemp = -999.0; // Ã¶nceki deÄŸer (flicker Ã¶nleme)
unsigned long lastUpdate = 0;
bool dataReceived = false;

void setup() {
  Serial.begin(9600);

  lcd.begin(16, 2);
  lcd.print("Sicaklik Olcer");
  lcd.setCursor(0, 1);
  lcd.print("Veri Bekleniyor...");

  Serial.println("Alici Istasyon Hazir");
}

void loop() {
  // Yeni veri geldi mi?
  if (Serial.available()) {
    String data = Serial.readStringUntil('\n');
    data.trim();

    // SÄ±caklÄ±k deÄŸerine Ã§evir
    temperature = data.toFloat();

    // Veri geÃ§erliyse ekrana yaz
    if (temperature > -50 && temperature < 100) {
      updateDisplay();
      Serial.print("<<< ALINAN SICAKLIK: ");
      Serial.print(temperature, 1);
      Serial.println(" C");

      lastUpdate = millis();
      dataReceived = true;
    }
  }

  // 10 saniye veri gelmezse "baÄŸlantÄ± yok" uyarÄ±sÄ±
  if (dataReceived && (millis() - lastUpdate > 10000)) {
    lcd.clear();
    lcd.print("Veri Kesildi!");
    lcd.setCursor(0, 1);
    lcd.print("Baglanti Yok");
    dataReceived = false;
  }

  delay(50);
}

// ðŸ”¹ EkranÄ± yalnÄ±zca sÄ±caklÄ±k deÄŸiÅŸtiÄŸinde gÃ¼ncelle
void updateDisplay() {
  if (abs(temperature - lastDisplayedTemp) >= 0.1) {
    lcd.clear();
    lcd.setCursor(0, 0);
    lcd.print("Sicaklik:");

    lcd.setCursor(0, 1);
    lcd.print(temperature, 1);
    lcd.print(" C");

    lastDisplayedTemp = temperature;
  }
}
